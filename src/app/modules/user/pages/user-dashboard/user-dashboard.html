<div class="min-h-screen bg-base-200 p-4 md:p-8">
  <div class="max-w-5xl mx-auto">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-3xl font-bold mb-2">ðŸ‘‹ Mis Solicitudes</h1>
        <p class="opacity-60">Historial de tus peticiones de asesorÃ­a.</p>
      </div>
      <button class="btn btn-primary" (click)="openModal()">+ Nueva AsesorÃ­a</button>
    </div>

    <div class="grid gap-4">
      @for (req of myAdvisories$ | async; track req.id) {
        <div class="card bg-base-100 shadow-md border-l-4"
             [ngClass]="{'border-warning': req.status === 'pending', 'border-success': req.status === 'accepted', 'border-error': req.status === 'rejected'}">
          <div class="card-body flex-row justify-between items-center p-6">
            <div>
              <h2 class="font-bold text-lg">{{ req.topic }}</h2>
              <p class="text-sm opacity-70">Programador: <span class="font-semibold">{{ req.programmerName }}</span></p>
              <p class="text-xs mt-2 italic text-primary">Horario: {{ req.timeSlot }}</p>
            </div>
            <div class="badge badge-lg" [ngClass]="{'badge-warning': req.status === 'pending', 'badge-success': req.status === 'accepted', 'badge-error': req.status === 'rejected'}">
              {{ req.status | uppercase }}
            </div>
          </div>
        </div>
      } @empty {
        <div class="text-center py-10">
          <p class="text-lg">No has solicitado ninguna asesorÃ­a aÃºn.</p>
        </div>
      }
    </div>
  </div>
</div>

<dialog id="request_modal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-4">Solicitar Nueva AsesorÃ­a</h3>

    <div class="form-control w-full mb-4">
      <label class="label"><span class="label-text">Â¿Con quiÃ©n quieres aprender?</span></label>
      <select class="select select-bordered" (change)="onProgrammerChange(+($any($event.target).value))">
        <option disabled selected>Selecciona un programador</option>
        <option *ngFor="let p of programmers()" [value]="p.id">{{ p.name }} ({{p.specialty}})</option>
      </select>
    </div>

    <div class="form-control w-full mb-4">
      <label class="label"><span class="label-text">Horarios Disponibles</span></label>
      <select class="select select-bordered" [(ngModel)]="selectedSlot" [disabled]="availableSlots().length === 0">
        <option value="" disabled selected>Selecciona un horario</option>
        <option *ngFor="let s of availableSlots()" [value]="s">{{ s }}</option>
      </select>
      <p *ngIf="availableSlots().length === 0" class="text-xs text-error mt-1">Este programador no tiene horarios cargados.</p>
    </div>

    <div class="form-control w-full mb-4">
      <label class="label"><span class="label-text">Tema</span></label>
      <input type="text" [(ngModel)]="topic" placeholder="Ej: Error en NestJS" class="input input-bordered w-full" />
    </div>

    <div class="form-control w-full mb-4">
      <label class="label"><span class="label-text">Mensaje</span></label>
      <textarea [(ngModel)]="message" class="textarea textarea-bordered h-24" placeholder="CuÃ©ntale un poco mÃ¡s..."></textarea>
    </div>

    <div class="modal-action">
      <form method="dialog">
        <button class="btn">Cancelar</button>
      </form>
      <button class="btn btn-primary" (click)="submitRequest()" [disabled]="!selectedSlot() || !topic()">Enviar Solicitud</button>
    </div>
  </div>
</dialog>
