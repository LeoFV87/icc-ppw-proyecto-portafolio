<div class="p-6 max-w-6xl mx-auto">
  <div class="mb-8">
    <h1 class="text-3xl font-bold">ðŸ“¬ BuzÃ³n de Solicitudes</h1>
    <p class="opacity-60">Gestiona tus asesorÃ­as pendientes.</p>
  </div>

  <div class="grid gap-4">
    @for (req of myAdvisories$ | async; track req.id) {
      <div class="card bg-base-100 shadow-lg border border-base-200">
        <div class="card-body">

          <div class="flex justify-between items-start">
            <div>
              <h2 class="card-title text-primary">{{ req.topic }}</h2>
              <p class="text-sm font-bold">Cliente: {{ req.clientName }}</p>
              <p class="text-xs opacity-50">{{ req.clientEmail }}</p>
            </div>

            <div class="badge" [ngClass]="{
              'badge-warning': req.status === 'pending',
              'badge-success': req.status === 'accepted',
              'badge-error': req.status === 'rejected'
            }">
              {{ req.status | uppercase }}
            </div>
          </div>

          <div class="divider my-2"></div>

          <p><strong>ðŸ“… Horario Solicitado:</strong> {{ req.timeSlot }}</p>
          <p class="italic text-base-content/70">"{{ req.message }}"</p>

          @if (req.status === 'pending') {

            @if (selectedId === req.id) {
              <div class="mt-4 bg-base-200 p-4 rounded-xl animate-fade-in">
                <label class="label font-bold">Mensaje de Respuesta / JustificaciÃ³n *</label>
                <textarea [(ngModel)]="replyText" class="textarea textarea-bordered w-full" placeholder="Ej: Hola, confirmo nuestra reuniÃ³n..."></textarea>

                <div class="flex gap-2 mt-4 justify-end">
                  <button (click)="selectedId = null" class="btn btn-ghost btn-sm">Cancelar</button>
                  <button (click)="processRequest(req, 'rejected')" class="btn btn-error btn-sm text-white">Rechazar</button>
                  <button (click)="processRequest(req, 'accepted')" class="btn btn-success btn-sm text-white">Aprobar y Notificar</button>
                </div>
              </div>
            } @else {
              <div class="card-actions justify-end mt-4">
                <button (click)="openReply(req.id!)" class="btn btn-primary btn-sm">Responder Solicitud</button>
              </div>
            }

          } @else {
            <div class="mt-4 bg-base-200/50 p-3 rounded-lg text-sm">
              <span class="font-bold">Tu respuesta:</span> {{ req.replyMessage }}
            </div>
          }

        </div>
      </div>
    } @empty {
      <div class="text-center py-10 opacity-50">
        <p>No tienes solicitudes de asesorÃ­a por el momento.</p>
      </div>
    }
  </div>
</div>
